{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.regions = exports.WorldMap = void 0;\nconst tslib_1 = require(\"tslib\");\nconst React = tslib_1.__importStar(require(\"react\"));\nconst react_1 = require(\"react\");\nconst d3_geo_1 = require(\"d3-geo\");\nconst countries_geo_js_1 = tslib_1.__importDefault(require(\"./countries.geo.js\"));\nconst constants_js_1 = require(\"./constants.js\");\nconst utils_js_1 = require(\"./utils.js\");\nconst draw_js_1 = require(\"./draw.js\");\nconst Frame_js_1 = tslib_1.__importDefault(require(\"./components/Frame.js\"));\nconst Region_js_1 = tslib_1.__importDefault(require(\"./components/Region.js\"));\nconst TextLabel_js_1 = tslib_1.__importDefault(require(\"./components/TextLabel.js\"));\nfunction toValue({\n  value\n}) {\n  return typeof value === \"string\" ? 0 : value;\n}\nfunction WorldMap(props) {\n  const {\n    data,\n    title,\n    valuePrefix = \"\",\n    valueSuffix = \"\",\n    color = constants_js_1.defaultColor,\n    strokeOpacity = 0.2,\n    backgroundColor = \"white\",\n    tooltipBgColor = \"black\",\n    tooltipTextColor = \"white\",\n    rtl = false,\n    size = constants_js_1.defaultSize,\n    frame = false,\n    frameColor = \"black\",\n    borderColor = \"black\",\n    richInteraction = false,\n    styleFunction = (0, constants_js_1.defaultCountryStyle)(borderColor, strokeOpacity),\n    tooltipTextFunction = constants_js_1.defaultTooltip,\n    onClickFunction,\n    hrefFunction,\n    textLabelFunction = () => []\n  } = props;\n  const windowWidth = (0, utils_js_1.useWindowWidth)();\n  // Inits\n  const width = typeof size === \"number\" ? size : (0, utils_js_1.responsify)(size, windowWidth);\n  const height = width * constants_js_1.heightRatio;\n  const [scale, setScale] = (0, react_1.useState)(1);\n  const [translateX, setTranslateX] = (0, react_1.useState)(0);\n  const [translateY, setTranslateY] = (0, react_1.useState)(0);\n  const containerRef = (0, react_1.createRef)();\n  // Calc min/max values and build country map for direct access\n  const countryValueMap = Object.fromEntries(data.map(({\n    country,\n    value\n  }) => [country.toUpperCase(), value]));\n  const minValue = Math.min(...data.map(toValue));\n  const maxValue = Math.max(...data.map(toValue));\n  // Build a path & a tooltip for each country\n  const projection = (0, d3_geo_1.geoMercator)();\n  const pathGenerator = (0, d3_geo_1.geoPath)().projection(projection);\n  const onClick = React.useCallback(context => event => onClickFunction?.({\n    ...context,\n    event\n  }), [onClickFunction]);\n  const regions = countries_geo_js_1.default.features.map(feature => {\n    const triggerRef = (0, react_1.createRef)();\n    const {\n      I: isoCode,\n      N: countryName,\n      C: coordinates\n    } = feature;\n    const geoFeature = {\n      type: \"Feature\",\n      properties: {\n        NAME: countryName,\n        ISO_A2: isoCode\n      },\n      geometry: {\n        type: \"MultiPolygon\",\n        coordinates: coordinates\n      }\n    };\n    const context = {\n      countryCode: isoCode,\n      countryValue: countryValueMap[isoCode],\n      countryName,\n      color,\n      minValue,\n      maxValue,\n      prefix: valuePrefix,\n      suffix: valueSuffix\n    };\n    const path = React.createElement(Region_js_1.default, {\n      ref: triggerRef,\n      d: pathGenerator(geoFeature),\n      style: styleFunction(context),\n      onClick: onClick(context),\n      strokeOpacity: strokeOpacity,\n      href: hrefFunction?.(context),\n      key: countryName\n    });\n    const tooltip = (0, draw_js_1.drawTooltip)(typeof context.countryValue === \"undefined\" ? undefined : tooltipTextFunction(context), tooltipBgColor, tooltipTextColor, rtl, triggerRef, containerRef);\n    return {\n      path,\n      highlightedTooltip: tooltip\n    };\n  });\n  // Build paths\n  const regionPaths = regions.map(entry => entry.path);\n  // Build tooltips\n  const regionTooltips = regions.map(entry => entry.highlightedTooltip);\n  const eventHandlers = {\n    onMouseDown(e) {\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    onDoubleClick(e) {\n      const rect = e.currentTarget.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      if (scale === 4) {\n        setTranslateX(0);\n        setTranslateY(0);\n        setScale(1);\n      } else {\n        setTranslateX(2 * translateX - x);\n        setTranslateY(2 * translateY - y);\n        setScale(scale * 2);\n      }\n    }\n  };\n  // Render the SVG\n  return React.createElement(\"figure\", {\n    className: \"worldmap__figure-container\",\n    style: {\n      backgroundColor\n    }\n  }, title && React.createElement(\"figcaption\", {\n    className: \"worldmap__figure-caption\"\n  }, title), React.createElement(\"svg\", {\n    ref: containerRef,\n    height: `${height}px`,\n    width: `${width}px`,\n    ...(richInteraction ? eventHandlers : undefined)\n  }, frame && React.createElement(Frame_js_1.default, {\n    color: frameColor\n  }), React.createElement(\"g\", {\n    transform: `translate(${translateX}, ${translateY}) scale(${width / 960 * scale}) translate(0, 240)`,\n    style: {\n      transition: \"all 0.2s\"\n    }\n  }, regionPaths), React.createElement(\"g\", null, textLabelFunction(width).map(labelProps => React.createElement(TextLabel_js_1.default, {\n    ...labelProps,\n    key: labelProps.label\n  }))), regionTooltips));\n}\nexports.default = WorldMap;\nexports.WorldMap = WorldMap;\nconst regions = countries_geo_js_1.default.features.map(g => ({\n  name: g.N,\n  code: g.I\n}));\nexports.regions = regions;","map":{"version":3,"names":["React","tslib_1","__importStar","require","react_1","d3_geo_1","countries_geo_js_1","__importDefault","constants_js_1","utils_js_1","draw_js_1","Frame_js_1","Region_js_1","TextLabel_js_1","toValue","value","WorldMap","props","data","title","valuePrefix","valueSuffix","color","defaultColor","strokeOpacity","backgroundColor","tooltipBgColor","tooltipTextColor","rtl","size","defaultSize","frame","frameColor","borderColor","richInteraction","styleFunction","defaultCountryStyle","tooltipTextFunction","defaultTooltip","onClickFunction","hrefFunction","textLabelFunction","windowWidth","useWindowWidth","width","responsify","height","heightRatio","scale","setScale","useState","translateX","setTranslateX","translateY","setTranslateY","containerRef","createRef","countryValueMap","Object","fromEntries","map","country","toUpperCase","minValue","Math","min","maxValue","max","projection","geoMercator","pathGenerator","geoPath","onClick","useCallback","context","event","regions","default","features","feature","triggerRef","I","isoCode","N","countryName","C","coordinates","geoFeature","type","properties","NAME","ISO_A2","geometry","countryCode","countryValue","prefix","suffix","path","createElement","ref","d","style","href","key","tooltip","drawTooltip","undefined","highlightedTooltip","regionPaths","entry","regionTooltips","eventHandlers","onMouseDown","e","preventDefault","stopPropagation","onDoubleClick","rect","currentTarget","getBoundingClientRect","x","clientX","left","y","clientY","top","className","transform","transition","labelProps","label","exports","g","name","code"],"sources":["../src/index.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}